<div class="settings attach-kpis">

  <div class="attach-kpi">
    <h5 translate>impac.widget.settings.attach_kpis.attach_an_alert</h5>
    <form name="attachKpiForm" class='attach-kpi-form'>
      <!-- <div class="row nomargin">
        <select class="form-control input-sm" ng-model="kpi.endpoint" ng-options="kpi.endpoint as formatKpiName(kpi.endpoint) for kpi in availableKpis" ng-change="selectKpi()"></select>
      </div>
      <div class="row nomargin">
        <div class="extra-params" ng-repeat="(param, paramValues) in kpi.possibleExtraParams track by $index">
          <select class="form-control input-sm" name="{{param}}" ng-model="kpi.extra_params[param]" ng-options="value.id as value.label for value in paramValues" ng-init="kpi.extra_params[param] = paramValues[0].id"></select>
        </div>
      </div> -->
      <div class="row nomargin kpi-description">
        <!-- TODO: support for multiple extra params, and watchables. -->
        {{'impac.widget.settings.attach_kpis.keep_the' | translate}} {{elementWatched}} <span ng-if="showExtraParam">{{'impac.widget.settings.attach_kpis.of' | translate}} {{extraParams[selectedParam].name}}</span>:
      </div>
      <div class="row nomargin">
        <div class="col-xs-5 nopadding">
          <select class="pull-left form-control input-sm" ng-model="kpi.limit.mode" ng-options="option.mode as option.label for option in possibleTargets" ></select>
        </div>
        <div class="form-group col-xs-5 nopadding nomargin" ng-class="attachKpiForm.limitValue.$valid ? 'has-success' : 'has-error'">
          <input name="limitValue" type="text" pattern="-?[0-9]+" class="form-control input-sm attach-target" ng-model="kpi.limit.value" required>
          <!-- TODO: return possible units from API? -->
          <!-- <span class="form-control-feedback" aria-hidden="true">{{kpi.data.unit}}</span> -->
          <div class="error-messages limit" ng-messages="attachKpiForm.limitValue.$error">
            <span ng-message="required" translate>impac.widget.settings.attach_kpis.kpi_target_require</span>
            <span ng-message="pattern" translate>impac.widget.settings.attach_kpis.kpi_target_number</span>
          </div>
        </div>
        <div class="col-xs-2 nopadding">
          <button class="btn btn-primary input-sm" ng-click="attachKpi()" ng-disabled="!hasValidTarget()"><i class="fa fa-plus"></i></button>
        </div>
      </div>
    </form>
  </div>

  <div class="list-group attached-kpis" ng-show="attachedKpis.length">
    <h5 translate>impac.widget.settings.attach_kpis.attached_alerts</h5>
    <div class="list-group-item clearfix attached-kpi" ng-repeat="kpi in attachedKpis track by $index">
      <div class="attached-kpi-name">{{'impac.widget.settings.attach_kpis.keep' | translate}} {{formatAttachedKpiTitle(kpi) | titleize}}</div>
      <div class="pull-right actions">
        <alerts-config kpi="kpi"></alerts-config>
        <div class="remove-attached-kpi" ng-click="deleteKpi(kpi)">
          <i class="fa fa-times"></i>
        </div>
      </div>
    </div>
  </div>

</div>
